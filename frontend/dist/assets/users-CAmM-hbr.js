import{c as k,v as U,r,t as y,j as e,B as h,S as E}from"./index-H4DaqSpq.js";import{u as F}from"./useQuery-Rv5Od9FD.js";import{u as A}from"./useMutation-wEDAY8qW.js";import{a as C}from"./admin-client-Dm-1oUCg.js";import{I as D}from"./input-C4hLB7y9.js";import{B as S}from"./badge-pi7sX806.js";import{T as M,a as z,b as w,c,d as B,e as o}from"./table-CG2oaRXa.js";import{S as I,D as P,a as q,b as H,c as Q,d as R,e as K}from"./dialog-BUsDf1C4.js";import{S as V,a as O,b as G,c as J,d as f}from"./select-CVlxWidq.js";import{L as b}from"./label-bb9_ZhkL.js";import{C as W}from"./checkbox-UGBk40Hg.js";import{L as X}from"./loader-circle-5YA-BuFT.js";import{S as Y}from"./square-pen-BRqFuWG_.js";import"./index-EzDm0lmA.js";import"./index-D1IO__54.js";import"./index-DG8OgmhZ.js";import"./index-BTLX_OZX.js";import"./index-hI_Qe1FL.js";import"./index-CZMQeqyZ.js";import"./index-DOV0-nUu.js";import"./index-CQiHdsHp.js";import"./index-DIPJ9e2F.js";import"./index-BdQq_4o_.js";import"./index-BVj6NEvJ.js";import"./index-D8QmCQ3_.js";import"./index-DAIdUsKU.js";import"./chevron-down-gc8dYoSV.js";import"./check-s5UCxJch.js";import"./chevron-up-B8exOOsA.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],$=k("crown",Z);function ke(){const t=U(),[g,u]=r.useState(""),[j,p]=r.useState(""),[n,d]=r.useState(null),[a,m]=r.useState(0),i=50,{data:x,isLoading:l,error:v}=F({queryKey:["admin","users",a,j],queryFn:()=>C.getUsers(i,a*i,j||void 0)}),T=A({mutationFn:({userId:s,updates:N})=>C.updateUser(s,N),onSuccess:()=>{y.success("User details have been updated successfully"),t.invalidateQueries({queryKey:["admin","users"]}),d(null)},onError:s=>{y.error(s.message)}}),_=s=>{u(s);const N=setTimeout(()=>{p(s),m(0)},500);return()=>clearTimeout(N)};if(l)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(X,{className:"h-8 w-8 animate-spin text-muted-foreground"})});if(v)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"text-lg font-medium text-destructive",children:"Failed to load users"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:v instanceof Error?v.message:"Unknown error"})]});const L=Math.ceil((x?.total||0)/i);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search by email or name...",value:g,onChange:s=>_(s.target.value),className:"pl-8 w-[300px]"})]})})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(M,{children:[e.jsx(z,{children:e.jsxs(w,{children:[e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Tier"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Created"}),e.jsx(c,{children:"Last Login"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(B,{children:x?.users.map(s=>e.jsxs(w,{children:[e.jsx(o,{className:"font-medium",children:s.email}),e.jsx(o,{children:s.full_name||"-"}),e.jsx(o,{children:e.jsx(S,{variant:"outline",className:"capitalize",children:s.subscription_tier||"free"})}),e.jsx(o,{children:s.is_admin?e.jsxs(S,{variant:"default",children:[e.jsx($,{className:"mr-1 h-3 w-3"}),"Admin"]}):e.jsx(S,{variant:"secondary",children:"User"})}),e.jsx(o,{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(o,{className:"text-sm text-muted-foreground",children:s.last_login?new Date(s.last_login).toLocaleDateString():"-"}),e.jsx(o,{children:e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>d(s),children:e.jsx(Y,{className:"h-4 w-4"})})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",a*i+1," to ",Math.min((a+1)*i,x?.total||0)," of"," ",x?.total||0," users"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m(Math.max(0,a-1)),disabled:a===0,children:"Previous"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m(a+1),disabled:a>=L-1,children:"Next"})]})]}),e.jsx(ee,{user:n,open:!!n,onClose:()=>d(null),onSave:s=>{n&&T.mutate({userId:n.id,updates:s})}})]})}function ee({user:t,open:g,onClose:u,onSave:j}){const[p,n]=r.useState(""),[d,a]=r.useState("free"),[m,i]=r.useState(!1);r.useState(()=>{t&&(n(t.full_name||""),a(t.subscription_tier||"free"),i(t.is_admin))});const x=()=>{j({full_name:p||void 0,subscription_tier:d,is_admin:m})};return t?e.jsx(P,{open:g,onOpenChange:u,children:e.jsxs(q,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Edit User"}),e.jsx(R,{children:t.email})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"fullName",children:"Full Name"}),e.jsx(D,{id:"fullName",value:p,onChange:l=>n(l.target.value),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"tier",children:"Subscription Tier"}),e.jsxs(V,{value:d,onValueChange:l=>a(l),children:[e.jsx(O,{id:"tier",children:e.jsx(G,{})}),e.jsxs(J,{children:[e.jsx(f,{value:"free",children:"Free"}),e.jsx(f,{value:"basic",children:"Basic"}),e.jsx(f,{value:"pro",children:"Pro"}),e.jsx(f,{value:"enterprise",children:"Enterprise"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{id:"isAdmin",checked:m,onCheckedChange:l=>i(!!l)}),e.jsxs(b,{htmlFor:"isAdmin",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(E,{className:"h-4 w-4"}),"Admin Access"]})]})]}),e.jsxs(K,{children:[e.jsx(h,{variant:"outline",onClick:u,children:"Cancel"}),e.jsx(h,{onClick:x,children:"Save Changes"})]})]})}):null}export{ke as component};
