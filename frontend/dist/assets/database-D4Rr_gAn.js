import{c as Q,r as m,t as E,j as e,B as l,n as U}from"./index-ElL2QLOY.js";import{u as v}from"./useQuery-C_Ijo3gY.js";import{u as H}from"./useMutation-Cc8shgLd.js";import{a as N}from"./admin-client-Dm-1oUCg.js";import{C as x,a as u,b as h,c as j,d as f}from"./card-BmBIW6jc.js";import{B as T}from"./badge-qFoGNtRD.js";import{T as _,a as S,b as p,c as L,d as k,e as M}from"./table-CP_HvbWO.js";import{T as A}from"./textarea-Dnqo0GbZ.js";import{L as C}from"./loader-circle-B8CuY038.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],q=Q("play",Y);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],G=Q("table",$);function te(){const[a,F]=m.useState(null),[n,y]=m.useState(0),[d,w]=m.useState(!1),[b,g]=m.useState("SELECT * FROM users LIMIT 10;"),i=50,{data:O,isLoading:z}=v({queryKey:["admin","tables"],queryFn:()=>N.getDatabaseTables()}),{data:r,isLoading:D}=v({queryKey:["admin","table-data",a,n],queryFn:()=>a?N.getTableData(a,i,n*i):null,enabled:!!a&&!d}),t=H({mutationFn:s=>N.executeQuery(s),onError:s=>{E.error(s.message)}}),P=()=>{if(!b.trim()){E.error("Please enter a SQL query");return}t.mutate(b)};if(z)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-muted-foreground"})});const B=r?Math.ceil(r.total/i):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Database Viewer"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:d?"outline":"default",size:"sm",onClick:()=>{w(!1),t.reset()},children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Tables"]}),e.jsxs(l,{variant:d?"default":"outline",size:"sm",onClick:()=>w(!0),children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Query"]})]})]}),d?e.jsxs(e.Fragment,{children:[e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"SQL Query Executor"}),e.jsx(j,{children:"Execute read-only SQL queries (SELECT, WITH, EXPLAIN only)"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{value:b,onChange:s=>g(s.target.value),placeholder:"Enter your SQL query...",className:"font-mono text-sm min-h-[150px]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{onClick:P,disabled:t.isPending,children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Executing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Execute Query"]})}),e.jsx(l,{variant:"outline",onClick:()=>{g(""),t.reset()},children:"Clear"})]})]}),t.isError&&e.jsx("div",{className:"rounded-lg bg-red-50 dark:bg-red-950/20 p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-red-600 dark:text-red-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-900 dark:text-red-100",children:"Query Failed"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:t.error instanceof Error?t.error.message:"Unknown error"})]})]})}),t.isSuccess&&t.data&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium",children:"Query Results"}),e.jsxs(T,{variant:"secondary",children:[t.data.rowCount," ",t.data.rowCount===1?"row":"rows"]})]}),e.jsx("div",{className:"rounded-md border overflow-x-auto max-h-[500px] overflow-y-auto",children:e.jsxs(_,{children:[e.jsx(S,{children:e.jsx(p,{children:t.data.columns.map((s,c)=>e.jsx(L,{children:s.name},c))})}),e.jsx(k,{children:t.data.rows.map((s,c)=>e.jsx(p,{children:t.data.columns.map((o,I)=>e.jsx(M,{className:"max-w-xs truncate",children:R(s[o.name])},I))},c))})]})})]})]})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Query Examples"}),e.jsx(j,{children:"Click to use these example queries"})]}),e.jsx(f,{className:"space-y-2",children:[{label:"List all users",query:"SELECT id, email, full_name, created_at FROM users LIMIT 20;"},{label:"Count scans by status",query:"SELECT status, COUNT(*) as count FROM scans GROUP BY status;"},{label:"Recent scans",query:"SELECT id, user_id, twitter_handle, status, created_at FROM scans ORDER BY created_at DESC LIMIT 10;"},{label:"User subscription tiers",query:"SELECT subscription_tier, COUNT(*) as count FROM users GROUP BY subscription_tier;"},{label:"Table sizes",query:"SELECT schemaname, tablename, pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size FROM pg_tables WHERE schemaname = 'public' ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;"}].map(s=>e.jsx(l,{variant:"outline",className:"w-full justify-start text-left h-auto py-2",onClick:()=>g(s.query),children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:"text-xs text-muted-foreground font-mono mt-1",children:s.query})]})},s.label))})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Database Tables"}),e.jsx(j,{children:"Select a table to view its data"})]}),e.jsx(f,{children:e.jsx("div",{className:"grid gap-2 md:grid-cols-3 lg:grid-cols-4",children:O?.map(s=>e.jsxs(l,{variant:a===s.name?"default":"outline",className:"justify-between",onClick:()=>{F(s.name),y(0)},children:[e.jsx("span",{className:"truncate",children:s.name}),e.jsx(T,{variant:"secondary",className:"ml-2",children:s.row_count})]},s.name))})})]}),a&&e.jsxs(x,{children:[e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(h,{children:a}),e.jsx(j,{children:r?`${r.total} total rows`:"Loading..."})]})})}),e.jsx(f,{children:D?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):r&&r.rows.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(_,{children:[e.jsx(S,{children:e.jsx(p,{children:r.columns.map(s=>e.jsx(L,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.column_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.data_type})]})},s.column_name))})}),e.jsx(k,{children:r.rows.map((s,c)=>e.jsx(p,{children:r.columns.map(o=>e.jsx(M,{className:"max-w-xs truncate",children:R(s[o.column_name])},o.column_name))},c))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",n*i+1," to"," ",Math.min((n+1)*i,r.total)," of ",r.total," rows"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>y(Math.max(0,n-1)),disabled:n===0,children:"Previous"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>y(n+1),disabled:n>=B-1,children:"Next"})]})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No data found"})})]})]})]})}function R(a){return a==null?"-":typeof a=="boolean"?a?"true":"false":typeof a=="object"?JSON.stringify(a):typeof a=="string"&&a.length>100?a.substring(0,100)+"...":String(a)}export{te as component};
