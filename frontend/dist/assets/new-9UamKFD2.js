import{a as D,b as E,r as M,o as B,t as c,j as e,B as m,L as y,n as L,y as V,s as w}from"./index-H4DaqSpq.js";import{u as z}from"./useQuery-Rv5Od9FD.js";import{u as b}from"./useMutation-wEDAY8qW.js";import{u as q,a as H,F as U,b as x,c as p,d as h,e as j,h as f,f as N}from"./form-BCfhzYnC.js";import{C as S,a as C,b as v,c as F,d as k}from"./card-C0ZjAVn9.js";import{S as G,a as Y,b as $,c as K,d as o}from"./select-CVlxWidq.js";import{S as O,C as Q}from"./search-DeIJKnzn.js";import{H as W,T as J,P as X}from"./theme-switch-C5tdu85W.js";import{M as Z}from"./main-D5uzAE8u.js";import{C as ee}from"./checkbox-UGBk40Hg.js";import{n8nClient as d}from"./repazoo-client-hBgkOjH6.js";import{A as se}from"./arrow-left-DwvnLM5l.js";import{L as g}from"./loader-circle-5YA-BuFT.js";import{T as te}from"./twitter-B7-zA5FH.js";import{S as _}from"./scan-C6BcT5o7.js";import{R as re}from"./refresh-cw-CEViQTj1.js";import"./label-bb9_ZhkL.js";import"./index-DOV0-nUu.js";import"./index-BdQq_4o_.js";import"./index-D1IO__54.js";import"./index-BVj6NEvJ.js";import"./index-DG8OgmhZ.js";import"./index-CZMQeqyZ.js";import"./index-CQiHdsHp.js";import"./index-hI_Qe1FL.js";import"./index-BTLX_OZX.js";import"./index-D8QmCQ3_.js";import"./index-DAIdUsKU.js";import"./chevron-down-gc8dYoSV.js";import"./check-s5UCxJch.js";import"./chevron-up-B8exOOsA.js";import"./index-D0zLoMui.js";import"./index-DTAvTyP8.js";import"./index-DIPJ9e2F.js";import"./search-provider-BrsfzY6n.js";import"./command-D6Zdrqg1.js";import"./index-EzDm0lmA.js";import"./dialog-BUsDf1C4.js";import"./scroll-area-B7G2E8-s.js";import"./sign-out-dialog-hk5uccCc.js";import"./chevron-right-BARXRStm.js";import"./shield-alert-DNCMqb7A.js";import"./circle-check-BLnpqHR7.js";import"./separator-DONs4C7t.js";const ae=B({purpose:w().min(1,"Purpose is required"),custom_context:w().optional(),force_rescan:V().optional()});function Qe(){const P=D(),{auth:T}=E(),[n,A]=M.useState(null),l=T.user?.accountNo||"",{data:r}=z({queryKey:["user-twitter-status",l],queryFn:()=>d.getUserTwitterStatus(l)}),i=q({resolver:H(ae),defaultValues:{purpose:"visa",custom_context:"",force_rescan:!1}}),t=i.watch("purpose"),u=b({mutationFn:async()=>await d.connectTwitter({user_id:l,callback_url:"https://cfy.repazoo.com/api/twitter/oauth/callback"}),onSuccess:s=>{s.success&&s.auth_url?window.location.href=s.auth_url:c.error(s.error||"Failed to initiate Twitter connection")},onError:s=>{c.error(s instanceof Error?s.message:"Failed to connect Twitter")}}),a=b({mutationFn:s=>{const R=d.generateScanId();return d.createScan({twitter_handle:r?.twitter_handle||"",user_id:l,scan_id:R,purpose:s.purpose,custom_context:s.custom_context||"",force_rescan:s.force_rescan||!1})},onSuccess:s=>{s.status==="success"&&s.scan_id?(c.success("Self-scan started successfully!"),A(s.scan_id),setTimeout(()=>{P({to:"/scans/$scanId",params:{scanId:s.scan_id}})},1500)):s.error&&c.error(s.error)},onError:s=>{c.error(s instanceof Error?s.message:"Failed to start scan. Please try again.")}}),I=s=>{if(!r?.connected){c.error("Please connect your Twitter account first");return}a.mutate(s)};return e.jsxs(e.Fragment,{children:[e.jsxs(W,{fixed:!0,children:[e.jsx(O,{}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(J,{}),e.jsx(Q,{}),e.jsx(X,{})]})]}),e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(m,{asChild:!0,variant:"ghost",size:"sm",className:"mb-4",children:e.jsxs(y,{to:"/",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Run Self-Scan"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Analyze your own Twitter account for reputation risks"})]}),e.jsxs("div",{className:"max-w-2xl space-y-4",children:[!r?.connected&&e.jsxs(S,{className:"border-yellow-500 bg-yellow-50 dark:bg-yellow-950/20",children:[e.jsxs(C,{children:[e.jsxs(v,{className:"flex items-center gap-2 text-yellow-900 dark:text-yellow-100",children:[e.jsx(L,{className:"h-5 w-5"}),"Twitter Account Not Connected"]}),e.jsx(F,{className:"text-yellow-700 dark:text-yellow-300",children:"You need to connect your Twitter account before running a self-scan"})]}),e.jsx(k,{children:e.jsx(m,{onClick:()=>u.mutate(),disabled:u.isPending,className:"w-full",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Connect Twitter Account"]})})})]}),e.jsxs(S,{children:[e.jsxs(C,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Self-Service Reputation Scan"]}),e.jsx(F,{children:r?.connected?`Scanning your account: @${r.twitter_handle}`:"Connect your Twitter account to begin"})]}),e.jsxs(k,{children:[e.jsx(U,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(I),className:"space-y-6",children:[e.jsx(x,{control:i.control,name:"purpose",render:({field:s})=>e.jsxs(p,{children:[e.jsx(h,{children:"Scan Purpose"}),e.jsxs(G,{onValueChange:s.onChange,defaultValue:s.value,disabled:!r?.connected||a.isPending||!!n,children:[e.jsx(j,{children:e.jsx(Y,{children:e.jsx($,{placeholder:"Select your scan purpose"})})}),e.jsxs(K,{children:[e.jsx(o,{value:"visa",children:"USA Visa Application"}),e.jsx(o,{value:"student",children:"Student/Academic Application"}),e.jsx(o,{value:"employment",children:"Employment Background Check"}),e.jsx(o,{value:"general",children:"General Reputation Analysis"}),e.jsx(o,{value:"custom",children:"Custom Purpose"})]})]}),e.jsx(f,{children:"Choose the context for your reputation analysis"}),e.jsx(N,{})]})}),t==="custom"&&e.jsx(x,{control:i.control,name:"custom_context",render:({field:s})=>e.jsxs(p,{children:[e.jsx(h,{children:"Custom Context"}),e.jsx(j,{children:e.jsx("textarea",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",placeholder:"Describe your specific analysis requirements...",rows:4,...s,disabled:!r?.connected||a.isPending||!!n})}),e.jsx(f,{children:"Provide details about what you want to analyze"}),e.jsx(N,{})]})}),e.jsx(x,{control:i.control,name:"force_rescan",render:({field:s})=>e.jsxs(p,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(j,{children:e.jsx(ee,{checked:s.value,onCheckedChange:s.onChange,disabled:!r?.connected||a.isPending||!!n})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Force Full Rescan"]}),e.jsx(f,{children:"Ignore cached data and fetch all tweets fresh from Twitter. This will take longer but ensures you get the most up-to-date analysis."})]})]})}),t&&e.jsxs("div",{className:"rounded-lg bg-blue-50 dark:bg-blue-950/20 p-4",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-2",children:["Analysis Focus: ",t==="visa"?"USA Visa Application":t==="student"?"Student/Academic Application":t==="employment"?"Employment Background Check":t==="custom"?"Custom Analysis":"General Reputation"]}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[t==="visa"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Political views and controversial content"}),e.jsx("li",{children:"• Security concerns and extremism"}),e.jsx("li",{children:"• Immigration policy violations"}),e.jsx("li",{children:"• Character assessment for visa officers"})]}),t==="student"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Academic integrity and professionalism"}),e.jsx("li",{children:"• Signs of plagiarism or dishonesty"}),e.jsx("li",{children:"• Maturity and readiness for study"}),e.jsx("li",{children:"• Illegal activities or substance abuse"})]}),t==="employment"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Professional conduct and appropriateness"}),e.jsx("li",{children:"• Discriminatory or offensive content"}),e.jsx("li",{children:"• Comments about employers or colleagues"}),e.jsx("li",{children:"• Brand reputation impact"})]}),t==="general"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Overall sentiment and tone"}),e.jsx("li",{children:"• Controversial or problematic posts"}),e.jsx("li",{children:"• Harassment or toxic behavior"}),e.jsx("li",{children:"• Privacy and security concerns"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{type:"submit",disabled:!r?.connected||a.isPending||!!n,className:"flex-1",children:a.isPending?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Scan..."]}):n?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Redirecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Run My Self-Scan"]})}),e.jsx(m,{type:"button",variant:"outline",asChild:!0,disabled:a.isPending||!!n,children:e.jsx(y,{to:"/",children:"Cancel"})})]})]})}),e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"What gets analyzed:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Your recent tweets and retweets"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Purpose-specific risk assessment (0-100)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Sentiment analysis (positive, neutral, negative)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Toxicity detection and problematic content"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Actionable recommendations for improvement"})]})]})]})]})]})]})]})]})}export{Qe as component};
