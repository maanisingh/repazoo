import{c as _,r as x,b as C,o as I,j as e,d as P,n as A,L as f,B as u,s as S,l as E,_ as M,t as h}from"./index-pMfcpnTf.js";import{u as D,a as T,F as U,b as j,c as g,d as b,e as w,f as y}from"./form-Jdznho2N.js";import{I as W}from"./icon-facebook-mfr5DsfM.js";import{I as O}from"./icon-github-CT33THN_.js";import{I as B}from"./input-CEzZO6nY.js";import{P as G}from"./password-input-DGrB5IvP.js";import{A as H,b as J,a as R}from"./alert-aC-jnyGN.js";import{L as V}from"./loader-circle-Cbubtl-n.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],q=_("log-in",$),z=I({email:E({error:d=>d.input===""?"Please enter your email":void 0}),password:S().min(1,"Please enter your password").min(7,"Password must be at least 7 characters long")});function re({className:d,redirectTo:v,...N}){const[n,m]=x.useState(!1),[i,t]=x.useState(null),{auth:p}=C(),l=D({resolver:T(z),defaultValues:{email:"",password:""}});async function k(s){m(!0),t(null);try{const{n8nClient:o}=await M(async()=>{const{n8nClient:a}=await import("./repazoo-client-DWf3vMtU.js");return{n8nClient:a}},[]),r=await o.login({email:s.email,password:s.password});if(r.success&&r.token&&r.user_id){let a=!1;try{const c=r.token.split(".");c.length===3&&(a=JSON.parse(atob(c[1])).is_admin||!1)}catch(c){console.error("Failed to decode JWT:",c)}const L={accountNo:r.user_id,email:s.email,role:["user"],exp:Date.now()+1440*60*1e3,isAdmin:a};p.setUser(L),p.setAccessToken(r.token),h.success(`Welcome back, ${s.email}!`);const F=v||"/";window.location.href=F}else{const a=r.message||"Login failed";a.toLowerCase().includes("invalid")||a.toLowerCase().includes("not found")?t("We couldn't find an account with these credentials. Don't have an account yet?"):t(a),h.error(a),m(!1)}}catch(o){console.error("Login error:",o),t("We couldn't sign you in. Please check your email and password and try again."),h.error("Login failed. Please check your credentials."),m(!1)}}return e.jsx(U,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(k),className:P("grid gap-3",d),...N,children:[i&&e.jsxs(H,{variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(J,{children:"Unable to sign in"}),e.jsxs(R,{children:[i," ",e.jsx(f,{to:"/sign-up",className:"font-medium underline underline-offset-4",children:"Create an account"})]})]}),e.jsx(j,{control:l.control,name:"email",render:({field:s})=>e.jsxs(g,{children:[e.jsx(b,{children:"Email"}),e.jsx(w,{children:e.jsx(B,{placeholder:"name@example.com",...s,onChange:o=>{s.onChange(o),i&&t(null)}})}),e.jsx(y,{})]})}),e.jsx(j,{control:l.control,name:"password",render:({field:s})=>e.jsxs(g,{className:"relative",children:[e.jsx(b,{children:"Password"}),e.jsx(w,{children:e.jsx(G,{placeholder:"********",...s,onChange:o=>{s.onChange(o),i&&t(null)}})}),e.jsx(y,{}),e.jsx(f,{to:"/forgot-password",className:"text-muted-foreground absolute end-0 -top-0.5 text-sm font-medium hover:opacity-75",children:"Forgot password?"})]})}),e.jsxs(u,{className:"mt-2",disabled:n,children:[n?e.jsx(V,{className:"animate-spin"}):e.jsx(q,{}),"Sign in"]}),e.jsxs("div",{className:"relative my-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background text-muted-foreground px-2",children:"Or continue with"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(u,{variant:"outline",type:"button",disabled:n,children:[e.jsx(O,{className:"h-4 w-4"})," GitHub"]}),e.jsxs(u,{variant:"outline",type:"button",disabled:n,children:[e.jsx(W,{className:"h-4 w-4"})," Facebook"]})]})]})})}export{re as U};
