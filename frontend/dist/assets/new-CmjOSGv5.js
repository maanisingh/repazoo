import{a as E,b as M,r as R,o as B,t as n,j as e,B as m,L as p,n as L,s as h}from"./index-ElL2QLOY.js";import{u as V}from"./useQuery-C_Ijo3gY.js";import{u as j}from"./useMutation-Cc8shgLd.js";import{u as q,a as z,F as H,b as g,c as f,d as y,e as w,h as b,f as S}from"./form-CIB5X1w_.js";import{C as N,a as v,b as C,c as F,d as A}from"./card-BmBIW6jc.js";import{S as U,a as $,b as G,c as Y,d as o}from"./select-CnNT9R9r.js";import{S as K,C as O}from"./search-BvyR7Hik.js";import{H as Q,T as W,P as J}from"./theme-switch-DgNDDxsG.js";import{M as X}from"./main-OWuqkMjW.js";import{n8nClient as d}from"./n8n-client-BQEnKJiU.js";import{A as Z}from"./arrow-left-DrtEJRyZ.js";import{L as x}from"./loader-circle-B8CuY038.js";import{T as ee}from"./twitter-DPXe8Ywf.js";import{S as P}from"./scan-C44NLlEp.js";import"./label-nRLb584s.js";import"./index-DsMt2SBc.js";import"./index-BdQq_4o_.js";import"./index-Cx3I-v7w.js";import"./index-C3pmiPDp.js";import"./index-gxCnXE2L.js";import"./index-D3kJxfYJ.js";import"./index-DRzJs0Qu.js";import"./index-Cvoa4icN.js";import"./index-C7HWWNe7.js";import"./chevron-down-BV6iYEaI.js";import"./check-Cupu-s4p.js";import"./chevron-up-CF3XcXqP.js";import"./index-BpthClAz.js";import"./index-BIER0rdt.js";import"./index-DAxGkIhI.js";import"./search-provider-CcZJHLpK.js";import"./command-CjD0V34D.js";import"./index-U_95C7Wj.js";import"./dialog-CAGtdnrt.js";import"./sign-out-dialog-883qO0FM.js";import"./chevron-right-DIuk9Gx1.js";import"./shield-alert-Bk-WdKBX.js";import"./circle-check-uVpUu6uM.js";import"./separator-BVjW7DQj.js";const se=B({purpose:h().min(1,"Purpose is required"),custom_context:h().optional()});function ze(){const k=E(),{auth:T}=M(),[i,_]=R.useState(null),l=T.user?.accountNo||"",{data:r}=V({queryKey:["user-twitter-status",l],queryFn:()=>d.getUserTwitterStatus(l)}),c=q({resolver:z(se),defaultValues:{purpose:"visa",custom_context:""}}),t=c.watch("purpose"),u=j({mutationFn:async()=>await d.connectTwitter({user_id:l,callback_url:`${window.location.origin}/api/twitter/oauth/callback`}),onSuccess:s=>{s.success&&s.auth_url?window.location.href=s.auth_url:n.error(s.error||"Failed to initiate Twitter connection")},onError:s=>{n.error(s instanceof Error?s.message:"Failed to connect Twitter")}}),a=j({mutationFn:s=>{const D=d.generateScanId();return d.createScan({twitter_handle:r?.twitter_handle||"",user_id:l,scan_id:D,purpose:s.purpose,custom_context:s.custom_context||""})},onSuccess:s=>{s.status==="success"&&s.scan_id?(n.success("Self-scan started successfully!"),_(s.scan_id),setTimeout(()=>{k({to:"/scans/$scanId",params:{scanId:s.scan_id}})},1500)):s.error&&n.error(s.error)},onError:s=>{n.error(s instanceof Error?s.message:"Failed to start scan. Please try again.")}}),I=s=>{if(!r?.connected){n.error("Please connect your Twitter account first");return}a.mutate(s)};return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{fixed:!0,children:[e.jsx(K,{}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(W,{}),e.jsx(O,{}),e.jsx(J,{})]})]}),e.jsxs(X,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(m,{asChild:!0,variant:"ghost",size:"sm",className:"mb-4",children:e.jsxs(p,{to:"/",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Run Self-Scan"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Analyze your own Twitter account for reputation risks"})]}),e.jsxs("div",{className:"max-w-2xl space-y-4",children:[!r?.connected&&e.jsxs(N,{className:"border-yellow-500 bg-yellow-50 dark:bg-yellow-950/20",children:[e.jsxs(v,{children:[e.jsxs(C,{className:"flex items-center gap-2 text-yellow-900 dark:text-yellow-100",children:[e.jsx(L,{className:"h-5 w-5"}),"Twitter Account Not Connected"]}),e.jsx(F,{className:"text-yellow-700 dark:text-yellow-300",children:"You need to connect your Twitter account before running a self-scan"})]}),e.jsx(A,{children:e.jsx(m,{onClick:()=>u.mutate(),disabled:u.isPending,className:"w-full",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Connect Twitter Account"]})})})]}),e.jsxs(N,{children:[e.jsxs(v,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Self-Service Reputation Scan"]}),e.jsx(F,{children:r?.connected?`Scanning your account: @${r.twitter_handle}`:"Connect your Twitter account to begin"})]}),e.jsxs(A,{children:[e.jsx(H,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(I),className:"space-y-6",children:[e.jsx(g,{control:c.control,name:"purpose",render:({field:s})=>e.jsxs(f,{children:[e.jsx(y,{children:"Scan Purpose"}),e.jsxs(U,{onValueChange:s.onChange,defaultValue:s.value,disabled:!r?.connected||a.isPending||!!i,children:[e.jsx(w,{children:e.jsx($,{children:e.jsx(G,{placeholder:"Select your scan purpose"})})}),e.jsxs(Y,{children:[e.jsx(o,{value:"visa",children:"USA Visa Application"}),e.jsx(o,{value:"student",children:"Student/Academic Application"}),e.jsx(o,{value:"employment",children:"Employment Background Check"}),e.jsx(o,{value:"general",children:"General Reputation Analysis"}),e.jsx(o,{value:"custom",children:"Custom Purpose"})]})]}),e.jsx(b,{children:"Choose the context for your reputation analysis"}),e.jsx(S,{})]})}),t==="custom"&&e.jsx(g,{control:c.control,name:"custom_context",render:({field:s})=>e.jsxs(f,{children:[e.jsx(y,{children:"Custom Context"}),e.jsx(w,{children:e.jsx("textarea",{className:"w-full rounded-md border bg-background px-3 py-2 text-sm",placeholder:"Describe your specific analysis requirements...",rows:4,...s,disabled:!r?.connected||a.isPending||!!i})}),e.jsx(b,{children:"Provide details about what you want to analyze"}),e.jsx(S,{})]})}),t&&e.jsxs("div",{className:"rounded-lg bg-blue-50 dark:bg-blue-950/20 p-4",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-2",children:["Analysis Focus: ",t==="visa"?"USA Visa Application":t==="student"?"Student/Academic Application":t==="employment"?"Employment Background Check":t==="custom"?"Custom Analysis":"General Reputation"]}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[t==="visa"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Political views and controversial content"}),e.jsx("li",{children:"• Security concerns and extremism"}),e.jsx("li",{children:"• Immigration policy violations"}),e.jsx("li",{children:"• Character assessment for visa officers"})]}),t==="student"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Academic integrity and professionalism"}),e.jsx("li",{children:"• Signs of plagiarism or dishonesty"}),e.jsx("li",{children:"• Maturity and readiness for study"}),e.jsx("li",{children:"• Illegal activities or substance abuse"})]}),t==="employment"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Professional conduct and appropriateness"}),e.jsx("li",{children:"• Discriminatory or offensive content"}),e.jsx("li",{children:"• Comments about employers or colleagues"}),e.jsx("li",{children:"• Brand reputation impact"})]}),t==="general"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Overall sentiment and tone"}),e.jsx("li",{children:"• Controversial or problematic posts"}),e.jsx("li",{children:"• Harassment or toxic behavior"}),e.jsx("li",{children:"• Privacy and security concerns"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{type:"submit",disabled:!r?.connected||a.isPending||!!i,className:"flex-1",children:a.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Scan..."]}):i?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"mr-2 h-4 w-4 animate-spin"}),"Redirecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Run My Self-Scan"]})}),e.jsx(m,{type:"button",variant:"outline",asChild:!0,disabled:a.isPending||!!i,children:e.jsx(p,{to:"/",children:"Cancel"})})]})]})}),e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"What gets analyzed:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Your recent tweets and retweets"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Purpose-specific risk assessment (0-100)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Sentiment analysis (positive, neutral, negative)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Toxicity detection and problematic content"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-1",children:"•"}),e.jsx("span",{children:"Actionable recommendations for improvement"})]})]})]})]})]})]})]})]})}export{ze as component};
